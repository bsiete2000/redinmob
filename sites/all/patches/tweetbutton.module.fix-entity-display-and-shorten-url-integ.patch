# This patch file was generated by NetBeans IDE
# It uses platform neutral UTF-8 encoding and \n newlines.
--- Index
+++ Modified In Working Tree
@@ -139,7 +139,7 @@
     'data-via'     => $options['account'],
     'data-related' => $options['rel_account'] . ':' . $options['rel_desc'],
     'data-text'    => token_replace($options['text'], $options['entity_type'], $entity),
-    'data-url'     => $options['url']? $options['url']: url('node/' . $entity->nid, array('absolute' => TRUE)),
+    'data-url'     => !empty($options['url']) ? $options['url'] : tweetbutton_shorten('node/'. ($entity ? $entity->nid : '')),
     'data-lang'    => $options['language'],
   );
 
@@ -199,4 +199,15 @@
     return $extras;
   }
 }
+/**
+ * Implementation of hook_shorten.
+ */
+function tweetbutton_shorten($url){
+  if (module_exists('shorten')) {
+    $result = shorten_url(url($url, array('absolute' => TRUE)));
+  } else {
+    $result = file_get_contents("http://tinyurl.com/api-create.php?url=" . url($url, array('absolute' => TRUE)));
+  }
 
+  return $result;
+}
\ No newline at end of file
